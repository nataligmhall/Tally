<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindful Path | Tracking with Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .active-tab { color: #6366f1; }
        .inactive-tab { color: #94a3b8; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .btn-bounce:active { transform: scale(0.95); }
    </style>
    <script type="importmap">
    {
      "imports": {
        "date-fns": "https://esm.sh/date-fns"
      }
    }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">
    <!-- App Root Container -->
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col pb-24 relative bg-white shadow-2xl shadow-slate-200">
        <!-- Rendered via JS -->
    </div>

    <!-- Navigation -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-md bg-white/80 backdrop-blur-md border-t border-slate-100 flex justify-around p-4 safe-bottom z-50">
        <button onclick="window.switchTab('track')" id="btn-track" class="flex flex-col items-center gap-1 px-4 py-2 rounded-2xl transition-all active-tab">
            <i data-lucide="layout-grid" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold uppercase tracking-wider">Track</span>
        </button>
        <button onclick="window.switchTab('trends')" id="btn-trends" class="flex flex-col items-center gap-1 px-4 py-2 rounded-2xl transition-all inactive-tab">
            <i data-lucide="bar-chart-3" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold uppercase tracking-wider">Trends</span>
        </button>
        <button onclick="window.switchTab('settings')" id="btn-settings" class="flex flex-col items-center gap-1 px-4 py-2 rounded-2xl transition-all inactive-tab">
            <i data-lucide="settings" class="w-6 h-6"></i>
            <span class="text-[10px] font-bold uppercase tracking-wider">Config</span>
        </button>
    </nav>

    <script type="module">
        import { format, subDays, isSameDay } from "date-fns";

        // --- Core Application State ---
        const DEFAULT_SETTINGS = {
            userName: "Meri",
            dailyGoal: "Live Healthier",
            positiveSymbol: "â¤ï¸",
            negativeSymbol: "ðŸ–¤"
        };

        const PHRASES = [
            "Master your impulses, or they will master you.",
            "Your habits are the architecture of your life. Build something great.",
            "The version of you that you want to become is waiting on the other side of consistency.",
            "Change is hard at first, messy in the middle, and gorgeous at the end.",
            "Decide who you want to be, then act like that person.",
            "Strength isn't the absence of struggle; it's the presence of resolve.",
            "Win the moment, win the day.",
            "You are stronger than a feeling.",
            "One choice at a time. One breath at a time. One day at a time.",
            "The best time to change was years ago. The second best time is right now.",
            "Action is the antidote to anxiety.",
            "Small disciplines lead to massive results.",
            "Be the boss of your brain.",
            "You are the architect of your own freedom.",
            "Everything you want is on the other side of fear.",
            "Your life is the sum of your choices. Choose well today.",
            "Make yourself proud."
        ];

        let records = JSON.parse(localStorage.getItem('mindful_records') || '[]');
        let settings = JSON.parse(localStorage.getItem('mindful_settings') || JSON.stringify(DEFAULT_SETTINGS));
        let currentTab = 'track';
        let insightMessage = PHRASES[Math.floor(Math.random() * PHRASES.length)];

        const persist = () => {
            localStorage.setItem('mindful_records', JSON.stringify(records));
            localStorage.setItem('mindful_settings', JSON.stringify(settings));
        };

        const rotateInsight = () => {
            insightMessage = PHRASES[Math.floor(Math.random() * PHRASES.length)];
        };

        // --- UI Rendering Engine ---
        const root = document.getElementById('app');

        function renderUI() {
            root.innerHTML = '';
            
            const header = document.createElement('header');
            header.id = "app-header";
            header.className = "p-6 pt-10 flex justify-between items-center bg-white/50 backdrop-blur-sm sticky top-0 z-40";
            header.innerHTML = `
                <div>
                    <h1 class="text-2xl font-black text-slate-900 tracking-tight">Mindful Path</h1>
                    <div class="flex items-center gap-1.5 mt-1 text-slate-500">
                        <i data-lucide="heart" class="w-3 h-3 text-red-400 fill-red-400"></i>
                        <span id="header-goal" class="text-[10px] font-bold uppercase tracking-widest opacity-70">${settings.dailyGoal}</span>
                    </div>
                </div>
                <div id="header-avatar" class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-black shadow-lg shadow-indigo-100 ring-4 ring-white">
                    ${settings.userName.charAt(0).toUpperCase()}
                </div>
            `;
            root.appendChild(header);

            const content = document.createElement('main');
            content.className = "flex-1 px-6 overflow-y-auto pb-12";
            
            if (currentTab === 'track') renderTrack(content);
            else if (currentTab === 'trends') renderTrends(content);
            else if (currentTab === 'settings') renderSettings(content);
            
            root.appendChild(content);
            
            lucide.createIcons();
            refreshNavState();
        }

        function renderTrack(container) {
            const insightBox = document.createElement('div');
            insightBox.className = "bg-indigo-50 border border-indigo-100 rounded-[2rem] p-5 mb-8 shadow-sm relative overflow-hidden";
            insightBox.innerHTML = `
                <div class="flex items-center gap-2 mb-2 relative z-10">
                    <i data-lucide="sparkles" class="w-4 h-4 text-indigo-500"></i>
                    <span class="text-[10px] font-bold text-indigo-600 uppercase tracking-widest">Mindful Insight</span>
                </div>
                <p class="text-slate-700 italic text-sm leading-relaxed relative z-10">
                    ${insightMessage}
                </p>
                <div class="absolute -right-4 -bottom-4 opacity-5">
                    <i data-lucide="sparkles" class="w-24 h-24 text-indigo-900"></i>
                </div>
            `;
            container.appendChild(insightBox);

            const todayKey = format(new Date(), 'yyyy-MM-dd');
            const todayLog = records.find(r => r.date === todayKey);
            
            const logCard = document.createElement('div');
            logCard.className = "bg-white rounded-[2rem] p-6 shadow-xl shadow-slate-100 mb-8 border border-slate-50";
            logCard.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-xl font-extrabold text-slate-800">How's your day?</h2>
                    <p class="text-xs font-semibold text-slate-400 mt-0.5 uppercase tracking-tighter">${format(new Date(), 'EEEE, MMMM do')}</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="window.logDay('positive')" class="btn-bounce group flex flex-col items-center justify-center py-8 rounded-3xl transition-all active:scale-95 ${todayLog?.type === 'positive' ? 'bg-red-50 ring-2 ring-red-500 text-red-700' : 'bg-red-500 text-white shadow-lg shadow-red-200 hover:bg-red-600'}">
                        <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">${settings.positiveSymbol}</div>
                        <span class="font-bold text-sm">Goal Met</span>
                        ${todayLog?.type === 'positive' ? '<i data-lucide="check-circle-2" class="w-4 h-4 mt-2"></i>' : ''}
                    </button>
                    <button onclick="window.logDay('negative')" class="btn-bounce group flex flex-col items-center justify-center py-8 rounded-3xl transition-all active:scale-95 ${todayLog?.type === 'negative' ? 'bg-slate-100 ring-2 ring-slate-800 text-slate-800' : 'bg-slate-800 text-white shadow-lg shadow-slate-200 hover:bg-slate-900'}">
                        <div class="text-4xl mb-2 group-hover:scale-110 transition-transform">${settings.negativeSymbol}</div>
                        <span class="font-bold text-sm">I Used</span>
                        ${todayLog?.type === 'negative' ? '<i data-lucide="check-circle-2" class="w-4 h-4 mt-2"></i>' : ''}
                    </button>
                </div>
            `;
            container.appendChild(logCard);

            const gridSection = document.createElement('div');
            gridSection.innerHTML = `
                <h3 class="text-sm font-black text-slate-900 mb-4 flex justify-between items-center px-1">
                    ACTIVITY LOG
                    <span class="text-[10px] font-bold text-slate-300">PAST 30 DAYS</span>
                </h3>
                <div id="calendar-grid" class="grid grid-cols-7 gap-2"></div>
            `;
            container.appendChild(gridSection);
            
            const calendar = gridSection.querySelector('#calendar-grid');
            const end = new Date();
            for (let i = 29; i >= 0; i--) {
                const date = subDays(end, i);
                const key = format(date, 'yyyy-MM-dd');
                const log = records.find(r => r.date === key);
                const isNow = isSameDay(date, end);
                
                let color = 'bg-slate-100';
                if (log?.type === 'positive') color = 'bg-red-500';
                else if (log?.type === 'negative') color = 'bg-slate-800';
                
                const cell = document.createElement('div');
                cell.className = "flex flex-col items-center";
                cell.innerHTML = `
                    <div class="w-10 h-10 rounded-xl ${color} ${isNow ? 'ring-2 ring-indigo-400 ring-offset-2 scale-110' : ''} flex items-center justify-center shadow-sm" title="${format(date, 'MMM d')}">
                        ${log?.type === 'positive' ? '<span class="text-white text-xs font-bold">âœ“</span>' : (log?.type === 'negative' ? '<span class="text-white text-xs font-bold">âœ•</span>' : '')}
                    </div>
                    <span class="text-[9px] mt-2 font-bold text-slate-400">${format(date, 'EE').charAt(0)}</span>
                `;
                calendar.appendChild(cell);
            }
        }

        function renderTrends(container) {
            const chartWrap = document.createElement('div');
            chartWrap.className = "bg-white rounded-[2rem] p-6 shadow-xl shadow-slate-50 border border-slate-50 mb-8";
            chartWrap.innerHTML = `
                <h3 class="text-lg font-black text-slate-800 mb-1">Success Flow</h3>
                <p class="text-[10px] font-bold text-slate-400 mb-8 uppercase tracking-widest">You've got this!</p>
                <div class="h-56 w-full"><canvas id="consistencyChart"></canvas></div>
            `;
            container.appendChild(chartWrap);

            setTimeout(() => {
                const ctx = document.getElementById('consistencyChart').getContext('2d');
                const labels = [];
                const values = [];
                
                for (let i = 13; i >= 0; i--) {
                    const date = subDays(new Date(), i);
                    labels.push(format(date, 'MMM d'));
                    
                    const windowStart = subDays(date, 6);
                    const windowItems = records.filter(r => {
                        const d = new Date(r.date);
                        return d >= windowStart && d <= date;
                    });
                    
                    const metCount = windowItems.filter(r => r.type === 'positive').length;
                    const pct = windowItems.length > 0 ? (metCount / windowItems.length) * 100 : 0;
                    values.push(Math.round(pct));
                }

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels,
                        datasets: [{
                            data: values,
                            borderColor: '#6366f1',
                            backgroundColor: 'rgba(99, 102, 241, 0.08)',
                            fill: true,
                            tension: 0.4,
                            borderWidth: 5,
                            pointRadius: 3,
                            pointBackgroundColor: '#6366f1',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, max: 100, grid: { color: '#f1f5f9' }, ticks: { font: { weight: 'bold', size: 9 }, color: '#94a3b8' } },
                            x: { grid: { display: false }, ticks: { font: { weight: 'bold', size: 9 }, color: '#94a3b8' } }
                        }
                    }
                });
            }, 100);

            const statGrid = document.createElement('div');
            statGrid.className = "grid grid-cols-2 gap-4";
            statGrid.innerHTML = `
                <div class="bg-red-50 p-6 rounded-[2rem] border border-red-100">
                    <span class="text-[9px] font-black text-red-400 uppercase tracking-widest block mb-2">Goals Met</span>
                    <span class="text-4xl font-black text-red-600">${records.filter(r => r.type === 'positive').length}</span>
                </div>
                <div class="bg-slate-100 p-6 rounded-[2rem] border border-slate-200">
                    <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-2">Total Logs</span>
                    <span class="text-4xl font-black text-slate-800">${records.length}</span>
                </div>
            `;
            container.appendChild(statGrid);
        }

        function renderSettings(container) {
            const settingsView = document.createElement('div');
            settingsView.className = "space-y-6";
            settingsView.innerHTML = `
                <div class="bg-white rounded-[2rem] p-7 shadow-sm border border-slate-100">
                    <div class="flex items-center gap-3 mb-8">
                        <i data-lucide="user-circle" class="w-6 h-6 text-indigo-500"></i>
                        <h3 class="text-xl font-black text-slate-800">Your Identity</h3>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Display Name</label>
                            <input type="text" oninput="window.updateSettingField(this, 'userName')" value="${settings.userName}" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                        </div>
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Daily Intention</label>
                            <input type="text" oninput="window.updateSettingField(this, 'dailyGoal')" value="${settings.dailyGoal}" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl font-bold outline-none focus:ring-2 focus:ring-indigo-500 transition-all">
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-[2rem] p-7 shadow-sm border border-slate-100">
                    <div class="flex items-center gap-3 mb-8">
                        <i data-lucide="palette" class="w-6 h-6 text-indigo-500"></i>
                        <h3 class="text-xl font-black text-slate-800">Customization</h3>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Goal Met Icon</label>
                            <input type="text" oninput="window.updateSettingField(this, 'positiveSymbol')" value="${settings.positiveSymbol}" class="w-full p-4 text-3xl text-center bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 px-1">Usage Icon</label>
                            <input type="text" oninput="window.updateSettingField(this, 'negativeSymbol')" value="${settings.negativeSymbol}" class="w-full p-4 text-3xl text-center bg-slate-50 border border-slate-200 rounded-2xl outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(settingsView);
        }

        function refreshNavState() {
            ['track', 'trends', 'settings'].forEach(t => {
                const el = document.getElementById(`btn-${t}`);
                if (t === currentTab) {
                    el.classList.add('active-tab');
                    el.classList.remove('inactive-tab');
                    el.classList.add('scale-110');
                } else {
                    el.classList.add('inactive-tab');
                    el.classList.remove('active-tab');
                    el.classList.remove('scale-110');
                }
            });
        }

        window.switchTab = (tab) => {
            currentTab = tab;
            if (tab === 'track') rotateInsight();
            renderUI();
        };

        window.logDay = (type) => {
            const today = format(new Date(), 'yyyy-MM-dd');
            const idx = records.findIndex(r => r.date === today);
            const entry = {
                id: idx >= 0 ? records[idx].id : Date.now().toString(),
                date: today,
                type,
                loggedAt: new Date().toISOString()
            };

            if (idx >= 0) records[idx] = entry;
            else records.push(entry);
            
            persist();
            renderUI();
        };

        /**
         * Surgical update for settings to prevent losing input focus.
         * Updates state and syncs specific UI elements like the header.
         */
        window.updateSettingField = (el, key) => {
            const val = el.value;
            settings[key] = val;
            persist();
            
            // Sync specific parts of the UI that depend on settings without full re-render
            const headerGoal = document.getElementById('header-goal');
            const headerAvatar = document.getElementById('header-avatar');
            
            if (key === 'dailyGoal' && headerGoal) {
                headerGoal.innerText = val;
            }
            if (key === 'userName' && headerAvatar) {
                headerAvatar.innerText = val.charAt(0).toUpperCase();
            }
            
            // Note: positive/negativeSymbol changes are visible next time they are rendered
            // as they affect grid items which require state-heavy re-draws.
        };

        renderUI();
    </script>
</body>
</html>
